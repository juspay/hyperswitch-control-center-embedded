!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Hyperswitch={})}(this,function(e){"use strict";const t="undefined"!=typeof window;class n{constructor(e,n){this.instance=e,this.options=n||{},this._internalId=`hyper-el-${Math.random().toString(36).substring(7)}`,this.boundMessageHandler=null,t&&(this.element=document.createElement("div"),this.iframe=document.createElement("iframe"),this.boundMessageHandler=this.handleMessage.bind(this),this.setupElement(),this.setupIframe(),window.addEventListener("message",this.boundMessageHandler))}setupElement(){t&&(this.element.className=`hyperswitch-element ${this.options.className||""}`.trim(),this.element.dataset.hyperswitchElement=this.getElementType(),Object.assign(this.element.style,Object.assign({width:this.options.width||"100%",height:this.options.height||"500px",overflow:"hidden"},this.options.style||{})))}setupIframe(){t&&(this.iframe.src=this.getIframeSrc(),this.iframe.style.border="none",this.iframe.style.width="100%",this.iframe.style.height="100%",this.iframe.title=`Hyperswitch ${this.getElementType()}`,this.iframe.setAttribute("allow","clipboard-read; clipboard-write; clipboard-sanitized-write"),this.iframe.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-forms allow-modals allow-presentation allow-downloads"),this.element.appendChild(this.iframe))}handleMessage(e){var n;if(t&&(this.options.onMessage&&this.options.onMessage(e.data),"EMBEDDED_COMPONENT_RESIZE"===(null===(n=e.data)||void 0===n?void 0:n.type))){const t=e.data.height;(e.data.component||"")===this.getElementType()&&"number"==typeof t&&t>0&&(this.element.style.height=`${t}px`,this.options.onResize&&this.options.onResize({width:this.element.clientWidth,height:t}))}}mount(e){if(!t)throw new Error("HyperswitchElement.mount can only be called in a browser environment");const n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`Invalid mount point: ${e}`);return n.appendChild(this.element),this}destroy(){t&&(this.boundMessageHandler&&window.removeEventListener("message",this.boundMessageHandler),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element))}getIframe(){return this.iframe}}class o extends n{constructor(e,t){super(e,t)}getElementType(){return"connectors"}getIframeSrc(){return`${this.options.url||"http://localhost:9000"}/embedded/connectors`}}const i="undefined"!=typeof window;class s{constructor(e){if(this.token=null,this.initConfig=null,this.activeElements=new Map,this.isRefetchingToken=!1,this.tokenError=null,!e||"function"!=typeof e.fetchToken)throw new Error("loadHyperswitch requires a fetchToken callback function");this.fetchToken=e.fetchToken,this.initConfig=e.initConfig?function(e){var t,n,o,i,s,r,l,a,d,h,c,u,m,f,p,g,v,E,y,w;const k=e||{};return{settings:{colors:{primary:null!==(t=k.primaryColor)&&void 0!==t?t:null,secondary:null,background:null!==(n=k.backgroundColor)&&void 0!==n?n:null},sidebar:null,typography:null,buttons:{primary:{backgroundColor:null!==(s=null===(i=null===(o=k.buttons)||void 0===o?void 0:o.primary)||void 0===i?void 0:i.backgroundColor)&&void 0!==s?s:null,textColor:null!==(a=null===(l=null===(r=k.buttons)||void 0===r?void 0:r.primary)||void 0===l?void 0:l.textColor)&&void 0!==a?a:null,hoverBackgroundColor:null!==(c=null===(h=null===(d=k.buttons)||void 0===d?void 0:d.primary)||void 0===h?void 0:h.hoverBackgroundColor)&&void 0!==c?c:null},secondary:{backgroundColor:null!==(f=null===(m=null===(u=k.buttons)||void 0===u?void 0:u.secondary)||void 0===m?void 0:m.backgroundColor)&&void 0!==f?f:null,textColor:null!==(v=null===(g=null===(p=k.buttons)||void 0===p?void 0:p.secondary)||void 0===g?void 0:g.textColor)&&void 0!==v?v:null,hoverBackgroundColor:null!==(w=null===(y=null===(E=k.buttons)||void 0===E?void 0:E.secondary)||void 0===y?void 0:y.hoverBackgroundColor)&&void 0!==w?w:null}},borders:null,spacing:null},urls:{faviconUrl:null,logoUrl:null}}}(e.initConfig):null,this.initPromise=this.fetchInitialToken(),this.listenForMessages()}fetchInitialToken(){return(()=>{try{return this.fetchToken()}catch(e){return Promise.reject(e)}})().then(e=>{e?this.token=e:this.tokenError="Failed to fetch token: Token returned empty or undefined"}).catch(e=>{this.tokenError=`Failed to fetch token: ${e instanceof Error?e.message:String(e)}`})}listenForMessages(){i&&window.addEventListener("message",async e=>{var t,n,o;"TOKEN_EXPIRED"===(null===(t=e.data)||void 0===t?void 0:t.type)&&!0===(null===(n=e.data)||void 0===n?void 0:n.value)?await this.refetchAndBroadcastToken():"EMBEDDED_IFRAME_READY"===(null===(o=e.data)||void 0===o?void 0:o.type)&&this.activeElements.forEach(t=>{const n=t.getIframe();(null==n?void 0:n.contentWindow)===e.source&&this.onElementIframeLoaded(t)})})}async refetchAndBroadcastToken(){if(!this.isRefetchingToken){this.isRefetchingToken=!0;try{const e=await this.fetchToken();e?(this.token=e,this.tokenError=null,this.activeElements.forEach((e,t)=>{const n=e.getIframe();(null==n?void 0:n.contentWindow)&&n.contentWindow.postMessage({type:"AUTH_TOKEN",token:this.token},"*")})):(this.tokenError="Failed to refetch token: Token returned empty or undefined",this.sendErrorToActiveElements(this.tokenError))}catch(e){this.tokenError=`Failed to refetch token: ${e instanceof Error?e.message:String(e)}`,this.sendErrorToActiveElements(this.tokenError)}finally{this.isRefetchingToken=!1}}}sendErrorToActiveElements(e){this.activeElements.forEach(t=>{const n=t.getIframe();(null==n?void 0:n.contentWindow)&&n.contentWindow.postMessage({type:"AUTH_ERROR",error:e},"*")})}create(e,t){let n;if("connectors"!==e)throw new Error(`Unknown element type: ${e}`);return n=new o(this,t),this.activeElements.set(n._internalId,n),n}onElementIframeLoaded(e){this.initPromise.then(()=>{const t=e.getIframe();(null==t?void 0:t.contentWindow)&&setTimeout(()=>{try{const e=t.contentWindow;if(!e)return;this.tokenError?e.postMessage({type:"AUTH_ERROR",error:this.tokenError},"*"):this.token?e.postMessage({type:"AUTH_TOKEN",token:this.token},"*"):e.postMessage({type:"AUTH_ERROR",error:"No token available"},"*"),this.initConfig&&e.postMessage({type:"INIT_CONFIG",init_config:this.initConfig},"*")}catch(e){}},100)}).catch(t=>{const n=e.getIframe(),o=null==n?void 0:n.contentWindow;o&&setTimeout(()=>{try{o.postMessage({type:"AUTH_ERROR",error:`Token initialization failed: ${t instanceof Error?t.message:String(t)}`},"*")}catch(e){}},100)})}}e.ConnectorConfigurationComponent=o,e.Hyperswitch=s,e.HyperswitchElement=n,e.VERSION="1.0.0",e.loadHyperswitch=function(e){return new s(e)},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.min.js.map
