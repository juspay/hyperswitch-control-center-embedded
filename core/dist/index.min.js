!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).HyperswitchEmbeddable={})}(this,function(t){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)};var n=function(){return n=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},n.apply(this,arguments)};function o(t,e,n,o){return new(n||(n=Promise))(function(r,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function l(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,l)}a((o=o.apply(t,e||[])).next())})}function r(t,e){var n,o,r,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=l(0),s.throw=l(1),s.return=l(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function l(l){return function(a){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&l[0]?o.return:l[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,l[1])).done)return r;switch(o=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,o=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=e.call(t,i)}catch(t){l=[6,t],o=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,a])}}}"function"==typeof SuppressedError&&SuppressedError;var i="undefined"!=typeof window&&"undefined"!=typeof document,s=function(){function t(t,e){this.instance=t,this.options=e||{},this._internalId="hyper-el-".concat(Math.random().toString(36).substring(7)),this.boundMessageHandler=null,i&&(this.element=document.createElement("div"),this.iframe=document.createElement("iframe"),this.boundMessageHandler=this.handleMessage.bind(this),this.setupElement(),this.setupIframe(),window.addEventListener("message",this.boundMessageHandler))}return t.prototype.setupElement=function(){i&&(this.element.className="hyperswitch-element ".concat(this.options.className||"").trim(),this.element.dataset.hyperswitchElement=this.getElementType(),Object.assign(this.element.style,n({width:this.options.width||"100%",height:this.options.height||"500px",overflow:"hidden"},this.options.style||{})))},t.prototype.setupIframe=function(){i&&(this.iframe.src=this.getIframeSrc(),this.iframe.style.border="none",this.iframe.style.width="100%",this.iframe.style.height="100%",this.iframe.title="Hyperswitch ".concat(this.getElementType()),this.iframe.setAttribute("allow","clipboard-read; clipboard-write; clipboard-sanitized-write"),this.iframe.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-forms allow-modals allow-presentation allow-downloads"),this.element.appendChild(this.iframe))},t.prototype.handleMessage=function(t){var e;if(i&&(this.options.onMessage&&this.options.onMessage(t.data),"EMBEDDED_COMPONENT_RESIZE"===(null===(e=t.data)||void 0===e?void 0:e.type))){var n=t.data.height;(t.data.component||"")===this.getElementType()&&"number"==typeof n&&n>0&&(this.element.style.height="".concat(n,"px"),this.options.onResize&&this.options.onResize({width:this.element.clientWidth,height:n}))}},t.prototype.mount=function(t){if(!i)throw new Error("HyperswitchElement.mount can only be called in a browser environment");var e="string"==typeof t?document.querySelector(t):t;if(!e)throw new Error("Invalid mount point: ".concat(t));return e.appendChild(this.element),this},t.prototype.destroy=function(){i&&(this.boundMessageHandler&&window.removeEventListener("message",this.boundMessageHandler),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element))},t.prototype.getIframe=function(){return this.iframe},t}(),l=function(t){function n(e,n){return t.call(this,e,n)||this}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}(n,t),n.prototype.getElementType=function(){return"connectors"},n.prototype.getIframeSrc=function(){var t=this.options.url||"http://localhost:9000";return"".concat(t,"/embedded/connectors")},n}(s);var a="undefined"!=typeof window,c=function(){function t(t){if(this.token=null,this.initConfig=null,this.activeElements=new Map,this.isRefetchingToken=!1,this.tokenError=null,!t||"function"!=typeof t.fetchToken)throw new Error("loadHyperswitch requires a fetchToken callback function");var e,n,o,r,i,s,l,a,c,u,d,h,f,p,v,y,m,g,w,E,b,k;this.fetchToken=t.fetchToken,this.initConfig=t.initConfig?(e=t.initConfig,{settings:{colors:{primary:null!==(n=(k=e||{}).primaryColor)&&void 0!==n?n:null,secondary:null,background:null!==(o=k.backgroundColor)&&void 0!==o?o:null},sidebar:null,typography:null,buttons:{primary:{backgroundColor:null!==(s=null===(i=null===(r=k.buttons)||void 0===r?void 0:r.primary)||void 0===i?void 0:i.backgroundColor)&&void 0!==s?s:null,textColor:null!==(c=null===(a=null===(l=k.buttons)||void 0===l?void 0:l.primary)||void 0===a?void 0:a.textColor)&&void 0!==c?c:null,hoverBackgroundColor:null!==(h=null===(d=null===(u=k.buttons)||void 0===u?void 0:u.primary)||void 0===d?void 0:d.hoverBackgroundColor)&&void 0!==h?h:null},secondary:{backgroundColor:null!==(v=null===(p=null===(f=k.buttons)||void 0===f?void 0:f.secondary)||void 0===p?void 0:p.backgroundColor)&&void 0!==v?v:null,textColor:null!==(g=null===(m=null===(y=k.buttons)||void 0===y?void 0:y.secondary)||void 0===m?void 0:m.textColor)&&void 0!==g?g:null,hoverBackgroundColor:null!==(b=null===(E=null===(w=k.buttons)||void 0===w?void 0:w.secondary)||void 0===E?void 0:E.hoverBackgroundColor)&&void 0!==b?b:null}},borders:null,spacing:null},urls:{faviconUrl:null,logoUrl:null}}):null,this.initPromise=this.fetchInitialToken(),this.listenForMessages()}return t.prototype.fetchInitialToken=function(){var t=this;return function(){try{return t.fetchToken()}catch(t){return Promise.reject(t)}}().then(function(e){e?t.token=e:t.tokenError="Failed to fetch token: Token returned empty or undefined"}).catch(function(e){t.tokenError="Failed to fetch token: ".concat(e instanceof Error?e.message:String(e))})},t.prototype.listenForMessages=function(){var t=this;a&&window.addEventListener("message",function(e){return o(t,void 0,void 0,function(){var t,n,o,i=this;return r(this,function(r){switch(r.label){case 0:return"TOKEN_EXPIRED"!==(null===(t=e.data)||void 0===t?void 0:t.type)||!0!==(null===(n=e.data)||void 0===n?void 0:n.value)?[3,2]:[4,this.refetchAndBroadcastToken()];case 1:return r.sent(),[3,3];case 2:"EMBEDDED_IFRAME_READY"===(null===(o=e.data)||void 0===o?void 0:o.type)&&this.activeElements.forEach(function(t){var n=t.getIframe();(null==n?void 0:n.contentWindow)===e.source&&i.onElementIframeLoaded(t)}),r.label=3;case 3:return[2]}})})})},t.prototype.refetchAndBroadcastToken=function(){return o(this,void 0,void 0,function(){var t,e,n=this;return r(this,function(o){switch(o.label){case 0:if(this.isRefetchingToken)return[2];this.isRefetchingToken=!0,o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,this.fetchToken()];case 2:return(t=o.sent())?(this.token=t,this.tokenError=null,this.activeElements.forEach(function(t,e){var o=t.getIframe();(null==o?void 0:o.contentWindow)&&o.contentWindow.postMessage({type:"AUTH_TOKEN",token:n.token},"*")})):(this.tokenError="Failed to refetch token: Token returned empty or undefined",this.sendErrorToActiveElements(this.tokenError)),[3,5];case 3:return e=o.sent(),this.tokenError="Failed to refetch token: ".concat(e instanceof Error?e.message:String(e)),this.sendErrorToActiveElements(this.tokenError),[3,5];case 4:return this.isRefetchingToken=!1,[7];case 5:return[2]}})})},t.prototype.sendErrorToActiveElements=function(t){this.activeElements.forEach(function(e){var n=e.getIframe();(null==n?void 0:n.contentWindow)&&n.contentWindow.postMessage({type:"AUTH_ERROR",error:t},"*")})},t.prototype.create=function(t,e){var n;if("connectors"!==t)throw new Error("Unknown element type: ".concat(t));return n=new l(this,e),this.activeElements.set(n._internalId,n),n},t.prototype.onElementIframeLoaded=function(t){var e=this;this.initPromise.then(function(){var n=t.getIframe();(null==n?void 0:n.contentWindow)&&setTimeout(function(){try{var t=n.contentWindow;if(!t)return;e.tokenError?t.postMessage({type:"AUTH_ERROR",error:e.tokenError},"*"):e.token?t.postMessage({type:"AUTH_TOKEN",token:e.token},"*"):t.postMessage({type:"AUTH_ERROR",error:"No token available"},"*"),e.initConfig&&t.postMessage({type:"INIT_CONFIG",init_config:e.initConfig},"*")}catch(t){}},100)}).catch(function(e){var n=t.getIframe(),o=null==n?void 0:n.contentWindow;o&&setTimeout(function(){try{o.postMessage({type:"AUTH_ERROR",error:"Token initialization failed: ".concat(e instanceof Error?e.message:String(e))},"*")}catch(t){}},100)})},t}();t.ConnectorConfigurationComponent=l,t.Hyperswitch=c,t.HyperswitchElement=s,t.VERSION="1.0.0",t.loadHyperswitch=function(t){return new c(t)},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.min.js.map
