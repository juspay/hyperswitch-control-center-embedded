{"version":3,"file":"index.esm.js","sources":["../src/element.ts","../src/connector-configuration.ts","../src/init-config.ts","../src/hyperswitch.ts","../src/index.ts"],"sourcesContent":["import { Hyperswitch } from './hyperswitch';\nimport { ElementOptions } from './types';\n\nconst isBrowser = typeof window !== 'undefined' && typeof document !== 'undefined';\n\nabstract class HyperswitchElement {\n  protected instance: Hyperswitch;\n  protected options: ElementOptions;\n  public element!: HTMLElement;\n  protected iframe!: HTMLIFrameElement;\n  private boundMessageHandler: ((event: MessageEvent) => void) | null;\n  public readonly _internalId: string;\n  \n  constructor(instance: Hyperswitch, options?: ElementOptions) {\n    this.instance = instance;\n    this.options = options || {};\n    this._internalId = `hyper-el-${Math.random().toString(36).substring(7)}`;\n    this.boundMessageHandler = null;\n    // In SSR / non-browser environments, avoid touching DOM APIs.\n    // The React wrapper only creates and mounts elements on the client,\n    // so it's safe for server-side usage as long as we no-op here.\n    if (!isBrowser) {\n      return;\n    }\n    \n    this.element = document.createElement('div');\n    this.iframe = document.createElement('iframe');\n    this.boundMessageHandler = this.handleMessage.bind(this);\n    \n    this.setupElement();\n    this.setupIframe();\n    window.addEventListener('message', this.boundMessageHandler);\n  }\n\n  private setupElement(): void {\n    if (!isBrowser) {\n      return;\n    }\n\n    this.element.className = `hyperswitch-element ${this.options.className || ''}`.trim();\n    this.element.dataset.hyperswitchElement = this.getElementType();\n    \n    Object.assign(this.element.style, {\n      width: this.options.width || '100%',\n      height: this.options.height || '500px',\n      overflow: 'hidden',\n      ...(this.options.style || {})\n    });\n  }\n  \n  private setupIframe(): void {\n    if (!isBrowser) {\n      return;\n    }\n\n    this.iframe.src = this.getIframeSrc();\n    this.iframe.style.border = 'none';\n    this.iframe.style.width = '100%';\n    this.iframe.style.height = '100%';\n    this.iframe.title = `Hyperswitch ${this.getElementType()}`;\n    this.iframe.setAttribute('allow', 'clipboard-read; clipboard-write; clipboard-sanitized-write');\n    this.iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-popups allow-forms allow-modals allow-presentation allow-downloads');\n    \n    this.element.appendChild(this.iframe);\n  }\n  \n  private handleMessage(event: MessageEvent): void {\n    if (!isBrowser) {\n      return;\n    }\n\n    if (this.options.onMessage) {\n      this.options.onMessage(event.data);\n    }\n    \n    if (event.data?.type === 'EMBEDDED_COMPONENT_RESIZE') {\n      const newHeight = event.data.height;\n      const messageComponent = event.data.component || '';\n      \n      if (messageComponent === this.getElementType() && typeof newHeight === 'number' && newHeight > 0) {\n        this.element.style.height = `${newHeight}px`;\n        \n        if (this.options.onResize) {\n          this.options.onResize({\n            width: this.element.clientWidth,\n            height: newHeight\n          });\n        }\n      }\n    }\n  }\n  \n  mount(domNode: string | HTMLElement): HyperswitchElement {\n    if (!isBrowser) {\n      throw new Error('HyperswitchElement.mount can only be called in a browser environment');\n    }\n\n    const parent = typeof domNode === 'string' \n      ? document.querySelector(domNode) \n      : domNode;\n      \n    if (!parent) {\n      throw new Error(`Invalid mount point: ${domNode}`);\n    }\n    \n    parent.appendChild(this.element);\n    return this;\n  }\n  \n  destroy(): void {\n    if (!isBrowser) {\n      return;\n    }\n    if (this.boundMessageHandler) {\n      window.removeEventListener('message', this.boundMessageHandler);\n    }\n    \n    if (this.element && this.element.parentNode) {\n      this.element.parentNode.removeChild(this.element);\n    }\n  }\n  \n  protected abstract getElementType(): string;\n  protected abstract getIframeSrc(): string;\n\n  public getIframe(): HTMLIFrameElement {\n    return this.iframe;\n  }\n}\n\nexport { HyperswitchElement };\n","import { Hyperswitch } from './hyperswitch';\nimport { HyperswitchElement } from './element';\nimport { ElementOptions } from './types';\n\nexport class ConnectorConfigurationComponent extends HyperswitchElement {\n  constructor(instance: Hyperswitch, options?: ElementOptions) {\n    super(instance, options);\n  }\n  \n  protected getElementType(): string {\n    return 'connectors';\n  }\n  \n  protected getIframeSrc(): string {\n    const baseUrl = this.options.url || 'http://localhost:9000';\n    return `${baseUrl}/embedded/connectors`;\n  }\n}\n","/**\n * Theme configuration received from the merchant.\n * This is the ONLY contract we expect merchants to follow.\n */\nexport type MerchantTheme = {\n  /** Primary color */\n  primaryColor?: string;\n  /** Page background color */\n  backgroundColor?: string;\n  /** Button configurations */\n  buttons?: {\n    /** Primary button configuration */\n    primary?: {\n      /** Primary button background color */\n      backgroundColor?: string;\n      /** Primary button text color */\n      textColor?: string;\n      /** Primary button hover background color */\n      hoverBackgroundColor?: string;\n    };\n    /** Secondary button configuration */\n    secondary?: {\n      /** Secondary button background color */\n      backgroundColor?: string;\n      /** Secondary button text color */\n      textColor?: string;\n      /** Secondary button hover background color */\n      hoverBackgroundColor?: string;\n    };\n  };\n};\n\n/**\n * Full init_config payload shape sent to the Control Center.\n * Most fields are null for now; Control Center applies defaults.\n */\nexport type InitConfig = {\n  settings: {\n    colors: {\n      primary: string | null;\n      secondary: string | null;\n      background: string | null;\n    };\n    sidebar: null;\n    typography: null;\n    buttons: {\n      primary: {\n        backgroundColor: string | null;\n        textColor: string | null;\n        hoverBackgroundColor: string | null;\n      };\n     secondary: {\n        backgroundColor: string | null;\n        textColor: string | null;\n        hoverBackgroundColor: string | null;\n      };\n    };\n    borders: null;\n    spacing: null;\n  };\n  urls: {\n    faviconUrl: null;\n    logoUrl: null;\n  };\n};\n\n/**\n * Build the init_config object that Control Center expects\n * from the simple MerchantTheme contract.\n *\n * Any missing value is set to null.\n */\nexport function buildInitConfig(merchantTheme: MerchantTheme | undefined | null): InitConfig {\n  const safeTheme = merchantTheme || {};\n\n  return {\n    settings: {\n      colors: {\n        primary: safeTheme.primaryColor ?? null,\n        secondary: null,\n        background: safeTheme.backgroundColor ?? null\n      },\n      sidebar: null,\n      typography: null,\n      buttons: {\n        primary: {\n          backgroundColor: safeTheme.buttons?.primary?.backgroundColor ?? null,\n          textColor: safeTheme.buttons?.primary?.textColor ?? null,\n          hoverBackgroundColor: safeTheme.buttons?.primary?.hoverBackgroundColor ?? null\n        },\n        secondary: {\n          backgroundColor: safeTheme.buttons?.secondary?.backgroundColor ?? null,\n          textColor: safeTheme.buttons?.secondary?.textColor ?? null,\n          hoverBackgroundColor: safeTheme.buttons?.secondary?.hoverBackgroundColor ?? null\n        }\n      },\n      borders: null,\n      spacing: null\n    },\n    urls: {\n      faviconUrl: null,\n      logoUrl: null\n    }\n  };\n}\n\n\n","import { HyperswitchElement } from './element';\nimport { ConnectorConfigurationComponent } from './connector-configuration';\nimport { HyperswitchInitOptions } from './types';\nimport { buildInitConfig,InitConfig } from './init-config';\n\nconst isBrowser = typeof window !== 'undefined';\n\nclass Hyperswitch {\n  private token: string | null = null;\n  private fetchToken: () => Promise<string | undefined>;\n  private initConfig: InitConfig | null = null;\n  private activeElements: Map<string, HyperswitchElement> =     new Map();\n  private isRefetchingToken: boolean = false;\n  private initPromise: Promise<void>;\n  private tokenError: string | null = null;\n\n  constructor(options: HyperswitchInitOptions) {\n    if (!options || typeof options.fetchToken !== 'function') {\n      throw new Error('loadHyperswitch requires a fetchToken callback function');\n    }\n\n    this.fetchToken = options.fetchToken;\n     this.initConfig = options.initConfig ? buildInitConfig(options.initConfig) : null;\n    this.initPromise = this.fetchInitialToken();\n    this.listenForMessages();\n  }\n\n  private fetchInitialToken(): Promise<void> {\n    const eagerTokenPromise = (() => {\n      try {\n        return this.fetchToken();\n      } catch (error) {\n        return Promise.reject(error);\n      }\n    })();\n\n    return eagerTokenPromise.then((token) => {\n      if (token) {\n        this.token = token;\n      } else {\n        this.tokenError = 'Failed to fetch token: Token returned empty or undefined';\n      }\n    }).catch((error) => {\n      this.tokenError = `Failed to fetch token: ${error instanceof Error ? error.message : String(error)}`;\n    });\n  } \n\n  private listenForMessages(): void {\n    if (!isBrowser) {\n      // In SSR / non-browser environments we can't listen for postMessage events,\n      // but it's still safe to create a Hyperswitch instance (it will become\n      // useful on the client where another instance will typically be created).\n      return;\n    }\n\n    window.addEventListener(\"message\", async (event) => {\n      if (event.data?.type === \"TOKEN_EXPIRED\" && event.data?.value === true) {\n        await this.refetchAndBroadcastToken();\n      } else if (event.data?.type === \"EMBEDDED_IFRAME_READY\") {\n        // Find the element whose iframe matches the event source\n        this.activeElements.forEach((element) => {\n          const iframe = element.getIframe();\n          if (iframe?.contentWindow === event.source) {\n            this.onElementIframeLoaded(element);\n          }\n        });\n      }\n    });\n  }\n\n  private async refetchAndBroadcastToken(): Promise<void> {\n    if (this.isRefetchingToken) {\n      return;\n    }\n    \n    this.isRefetchingToken = true;\n    \n    try {\n      const newToken = await this.fetchToken();\n      \n      if (newToken) {\n        this.token = newToken;\n        this.tokenError = null;\n        this.activeElements.forEach((element, elementId) => {\n          const iframe = element.getIframe();\n          if (iframe?.contentWindow) {\n            iframe.contentWindow.postMessage({\n              type: 'AUTH_TOKEN',\n              token: this.token\n            }, '*');\n          }\n        });\n      } else {\n        this.tokenError = 'Failed to refetch token: Token returned empty or undefined';\n        this.sendErrorToActiveElements(this.tokenError);\n      }\n    } catch (error) {\n      this.tokenError = `Failed to refetch token: ${error instanceof Error ? error.message : String(error)}`;\n      this.sendErrorToActiveElements(this.tokenError);\n    } finally {\n      this.isRefetchingToken = false;\n    }\n  }\n\n  private sendErrorToActiveElements(errorMessage: string): void {\n    this.activeElements.forEach((element) => {\n      const iframe = element.getIframe();\n      if (iframe?.contentWindow) {\n        iframe.contentWindow.postMessage({\n          type: 'AUTH_ERROR',\n          error: errorMessage\n        }, '*');\n      }\n    });\n  }\n\n  public create(type: string, options?: any): HyperswitchElement {\n    let element: HyperswitchElement;\n    \n    switch (type) {\n      case 'connectors':\n        element = new ConnectorConfigurationComponent(this, options);\n        break;\n      default:\n        throw new Error(`Unknown element type: ${type}`);\n    }\n    \n    this.activeElements.set(element._internalId, element);\n    \n    return element;\n  }\n\n  public onElementIframeLoaded(element: HyperswitchElement): void {\n    this.initPromise.then(() => {\n      const iframe = element.getIframe();\n      if (!iframe?.contentWindow) {\n        return;\n      }\n      \n      setTimeout(() => {\n        try {\n          const contentWindow = iframe.contentWindow;\n          if (!contentWindow) {\n            return;\n          }\n\n          if (this.tokenError) {\n            contentWindow.postMessage({\n              type: 'AUTH_ERROR',\n              error: this.tokenError\n            }, '*');\n          } else if (this.token) {\n            contentWindow.postMessage({\n              type: 'AUTH_TOKEN',\n              token: this.token\n            }, '*');\n          } else {\n            contentWindow.postMessage({\n              type: 'AUTH_ERROR',\n              error: 'No token available'\n            }, '*');\n          }\n\n          // Send init_config (if available) as a separate message\n          if (this.initConfig) {\n            contentWindow.postMessage({\n              type: 'INIT_CONFIG',\n              init_config: this.initConfig\n            }, '*');\n          }\n        } catch (error) {\n        }\n      }, 100);\n    }).catch((error) => {\n      const iframe = element.getIframe();\n      const contentWindow = iframe?.contentWindow;\n      if (contentWindow) {\n        setTimeout(() => {\n          try {\n            contentWindow.postMessage({\n              type: 'AUTH_ERROR',\n              error: `Token initialization failed: ${error instanceof Error ? error.message : String(error)}`\n            }, '*');\n          } catch {\n          }\n        }, 100);\n      }\n    });\n  }\n}\n\nexport function loadHyperswitch(options: HyperswitchInitOptions): Hyperswitch {\n  return new Hyperswitch(options);\n}\n\nexport { Hyperswitch };\n","export { loadHyperswitch, Hyperswitch } from './hyperswitch';\nexport { HyperswitchElement } from './element';\nexport { ConnectorConfigurationComponent } from './connector-configuration';\nexport type { HyperswitchInitOptions, ElementOptions } from './types';\nexport type { MerchantTheme } from './init-config';\n\nexport const VERSION = '1.0.0';\n"],"names":["isBrowser"],"mappings":"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"}