/*! For license information please see index.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("react"));else if("function"==typeof define&&define.amd)define(["react"],t);else{var n="object"==typeof exports?t(require("react")):t(e.react);for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,e=>(()=>{"use strict";var t={155:t=>{t.exports=e}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function c(e,t,n){return(t=u(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}r.r(o),r.d(o,{ConnectorConfiguration:()=>D,HyperswitchProvider:()=>I,VERSION:()=>C,loadHyperswitch:()=>_});var l="undefined"!=typeof window&&"undefined"!=typeof document;function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function d(e){var t=function(e){if("object"!=f(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(t)?t:t+""}function h(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(h=function(){return!!e})()}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}var v=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){return t=y(t),function(e,t){if(t&&("object"==f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,h()?Reflect.construct(t,n||[],y(e).constructor):t.apply(e,n))}(this,t,[e,n])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}(t,e),n=t,(r=[{key:"getElementType",value:function(){return"connectors"}},{key:"getIframeSrc",value:function(){var e=this.options.url||"http://localhost:9000";return"".concat(e,"/embedded/connectors")}}])&&p(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(function(){return e=function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"isEmbedded",!1),this.instance=t,this.options=n||{},this._internalId="hyper-el-".concat(Math.random().toString(36).substring(7)),!l)return this.element={},this.iframe={},this.loader={},void(this.boundMessageHandler=null);this.element=document.createElement("div"),this.iframe=document.createElement("iframe"),this.loader=document.createElement("div"),this.boundMessageHandler=this.handleMessage.bind(this),this.setupElement(),this.setupLoader(),this.setupIframe(),window.addEventListener("message",this.boundMessageHandler)},t=[{key:"setupElement",value:function(){l&&(this.element.className="hyperswitch-element ".concat(this.options.className||"").trim(),this.element.dataset.hyperswitchElement=this.getElementType(),Object.assign(this.element.style,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({width:this.options.width||"100%",height:this.options.height||"500px",overflow:"hidden",position:"relative"},this.options.style||{})))}},{key:"setupLoader",value:function(){if(l){this.loader.className="hyperswitch-loader",Object.assign(this.loader.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"12px",backgroundColor:"#f8f9fa",zIndex:"10"});var e=document.createElement("div");e.style.cssText="\n      width: 40px;\n      height: 40px;\n      border: 4px solid #e0e0e0;\n      border-top: 4px solid #3498db;\n      border-radius: 50%;\n      animation: hyperswitch-spin 1s linear infinite;\n    ";var t=document.createElement("div");if(t.textContent="Loading...",t.style.cssText="\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n      font-size: 14px;\n      color: #666;\n    ",!document.getElementById("hyperswitch-spinner-style")){var n=document.createElement("style");n.id="hyperswitch-spinner-style",n.textContent="\n        @keyframes hyperswitch-spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      ",document.head.appendChild(n)}this.loader.appendChild(e),this.loader.appendChild(t),this.element.appendChild(this.loader)}}},{key:"setupIframe",value:function(){var e=this;l&&(this.iframe.src=this.getIframeSrc(),this.iframe.style.border="none",this.iframe.style.width="100%",this.iframe.style.height="100%",this.iframe.title="Hyperswitch ".concat(this.getElementType()),this.iframe.style.position="relative",this.iframe.style.zIndex="1",this.iframe.style.visibility="hidden",this.element.appendChild(this.iframe),setTimeout(function(){e.isEmbedded||(console.warn("[HyperswitchElement] Timeout: EMBEDDED_IFRAME_READY not received, showing component anyway"),e.showEmbeddedComponent())},1e4))}},{key:"handleMessage",value:function(e){var t,n;if(l&&(console.log("[HyperswitchElement] Received message:",e.data,"Source matches iframe?",e.source===this.iframe.contentWindow),"EMBEDDED_IFRAME_READY"!==(null===(t=e.data)||void 0===t?void 0:t.type)||this.isEmbedded||e.source===this.iframe.contentWindow&&(console.log("[HyperswitchElement] EMBEDDED_IFRAME_READY received, showing component"),this.showEmbeddedComponent()),this.options.onMessage&&this.options.onMessage(e.data),"EMBEDDED_COMPONENT_RESIZE"===(null===(n=e.data)||void 0===n?void 0:n.type))){var r=e.data.height;(e.data.component||"")===this.getElementType()&&"number"==typeof r&&r>0&&(this.element.style.height="".concat(r,"px"),this.options.onResize&&this.options.onResize({width:this.element.clientWidth,height:r}))}}},{key:"showEmbeddedComponent",value:function(){l&&!this.isEmbedded&&(console.log("[HyperswitchElement] Showing embedded component"),this.isEmbedded=!0,this.loader&&(this.loader.style.display="none"),this.iframe.style.visibility="visible")}},{key:"mount",value:function(e){if(!l)throw new Error("Hyperswitch elements can only be mounted in a browser environment.");var t="string"==typeof e?document.querySelector(e):e;if(!t)throw new Error("Invalid mount point: ".concat(e));return t.appendChild(this.element),this}},{key:"destroy",value:function(){l&&(this.boundMessageHandler&&window.removeEventListener("message",this.boundMessageHandler),this.element.parentNode&&this.element.parentNode.removeChild(this.element))}},{key:"getIframe",value:function(){return this.iframe}}],t&&s(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function w(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return E(u,"_invoke",function(n,r,o){var i,s,c,u=0,l=o||[],f=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return i=t,s=0,c=e,p.n=n,a}};function d(n,r){for(s=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,i=l[t],d=p.p,h=i[2];n>3?(o=h===r)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=n<2&&d<i[1])?(s=0,p.v=r,p.n=i[1]):d<h&&(o=n<3||i[0]>r||r>h)&&(i[4]=n,i[5]=r,p.n=h,s=0))}if(o||n>1)return a;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,h),s=l,c=h;(t=s<2?e:c)||!f;){i||(s?s<3?(s>1&&(p.n=-1),d(s,c)):p.n=c:p.v=c);try{if(u=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(f=p.n<0)?c:n.call(r,p))!==a)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,i),!0),u}var a={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(E(t={},r,function(){return this}),t),f=u.prototype=s.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,E(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,E(f,"constructor",u),E(u,"constructor",c),c.displayName="GeneratorFunction",E(u,o,"GeneratorFunction"),E(f),E(f,o,"Generator"),E(f,r,function(){return this}),E(f,"toString",function(){return"[object Generator]"}),(w=function(){return{w:i,m:p}})()}function E(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}E=function(e,t,n,r){function i(t,n){E(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},E(e,t,n,r)}function g(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function k(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){g(i,r,o,a,s,"next",e)}function s(e){g(i,r,o,a,s,"throw",e)}a(void 0)})}}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,j(r.key),r)}}function T(e,t,n){return(t=j(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e){var t=function(e){if("object"!=b(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==b(t)?t:t+""}var S="undefined"!=typeof window,P=function(){return e=function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),T(this,"token",null),T(this,"activeElements",new Map),T(this,"isRefetchingToken",!1),T(this,"tokenError",null),!t||"function"!=typeof t.fetchToken)throw new Error("loadHyperswitch requires a fetchToken callback function");this.fetchToken=t.fetchToken,this.initPromise=this.fetchInitialToken(),S&&this.listenForMessages()},t=[{key:"fetchInitialToken",value:function(){var e=this;return function(){try{return e.fetchToken()}catch(e){return Promise.reject(e)}}().then(function(t){t?e.token=t:e.tokenError="Failed to fetch token: Token returned empty or undefined"}).catch(function(t){e.tokenError="Failed to fetch token: ".concat(t instanceof Error?t.message:String(t))})}},{key:"listenForMessages",value:function(){var e=this;S&&window.addEventListener("message",function(){var t=k(w().m(function t(n){var r,o,i;return w().w(function(t){for(;;)switch(t.n){case 0:if("TOKEN_EXPIRED"!==(null===(r=n.data)||void 0===r?void 0:r.type)||!0!==(null===(o=n.data)||void 0===o?void 0:o.value)){t.n=2;break}return t.n=1,e.refetchAndBroadcastToken();case 1:t.n=3;break;case 2:"EMBEDDED_IFRAME_READY"===(null===(i=n.data)||void 0===i?void 0:i.type)&&e.activeElements.forEach(function(t){var r=t.getIframe();(null==r?void 0:r.contentWindow)===n.source&&e.onElementIframeLoaded(t)});case 3:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"refetchAndBroadcastToken",value:(n=k(w().m(function e(){var t,n,r=this;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.isRefetchingToken){e.n=1;break}return e.a(2);case 1:return this.isRefetchingToken=!0,e.p=2,e.n=3,this.fetchToken();case 3:(t=e.v)?(this.token=t,this.tokenError=null,this.activeElements.forEach(function(e,t){var n=e.getIframe();null!=n&&n.contentWindow&&n.contentWindow.postMessage({type:"AUTH_TOKEN",token:r.token},"*")})):(this.tokenError="Failed to refetch token: Token returned empty or undefined",this.sendErrorToActiveElements(this.tokenError)),e.n=5;break;case 4:e.p=4,n=e.v,this.tokenError="Failed to refetch token: ".concat(n instanceof Error?n.message:String(n)),this.sendErrorToActiveElements(this.tokenError);case 5:return e.p=5,this.isRefetchingToken=!1,e.f(5);case 6:return e.a(2)}},e,this,[[2,4,5,6]])})),function(){return n.apply(this,arguments)})},{key:"sendErrorToActiveElements",value:function(e){this.activeElements.forEach(function(t){var n=t.getIframe();null!=n&&n.contentWindow&&n.contentWindow.postMessage({type:"AUTH_ERROR",error:e},"*")})}},{key:"create",value:function(e,t){var n;if("connectors"!==e)throw new Error("Unknown element type: ".concat(e));return n=new v(this,t),this.activeElements.set(n._internalId,n),n}},{key:"onElementIframeLoaded",value:function(e){var t=this;this.initPromise.then(function(){var n=e.getIframe();null!=n&&n.contentWindow&&setTimeout(function(){try{var e=n.contentWindow;if(!e)return;t.tokenError?e.postMessage({type:"AUTH_ERROR",error:t.tokenError},"*"):t.token?e.postMessage({type:"AUTH_TOKEN",token:t.token},"*"):e.postMessage({type:"AUTH_ERROR",error:"No token available"},"*")}catch(e){}},100)}).catch(function(t){var n=e.getIframe(),r=null==n?void 0:n.contentWindow;r&&setTimeout(function(){try{r.postMessage({type:"AUTH_ERROR",error:"Token initialization failed: ".concat(t instanceof Error?t.message:String(t))},"*")}catch(e){}},100)})}}],t&&O(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function _(e){return new P(e)}var R=r(155),x=r.n(R),M=(0,R.createContext)(null);function I(e){var t=e.hyperswitchInstance,n=e.children;return x().createElement(M.Provider,{value:t},n)}var D=function(e){var t=function(){var e=(0,R.useContext)(M);if(!e)throw new Error("useHyperswitchInstance must be used within a HyperswitchProvider");return e}(),n=(0,R.useRef)(null);return(0,R.useEffect)(function(){if(n.current){var r=t.create("connectors",e);return r.mount(n.current),function(){r.destroy()}}},[t,e]),R.createElement("div",{ref:n})};D.displayName="ConnectorConfiguration";var C="1.0.0";return o})());