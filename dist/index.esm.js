/*! For license information please see index.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.HyperswitchEmbeddable=t(require("react")):e.HyperswitchEmbeddable=t(e.react)}(globalThis,e=>(()=>{"use strict";var t={155:t=>{t.exports=e}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}r.r(o),r.d(o,{ConnectorConfiguration:()=>x,HyperswitchProvider:()=>H,VERSION:()=>A,loadHyperswitch:()=>_});var f="undefined"!=typeof window&&"undefined"!=typeof document;function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,h(r.key),r)}}function h(e){var t=function(e){if("object"!=l(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(t)?t:t+""}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(y=function(){return!!e})()}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}var v=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t,n){return t=d(t),function(e,t){if(t&&("object"==l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,y()?Reflect.construct(t,n||[],d(e).constructor):t.apply(e,n))}(this,t,[e,n])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}(t,e),n=t,(r=[{key:"getElementType",value:function(){return"connectors"}},{key:"getIframeSrc",value:function(){var e=this.options.url||"http://localhost:9000";return"".concat(e,"/embedded/connectors")}}])&&p(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(function(){return e=function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.instance=t,this.options=n||{},this._internalId="hyper-el-".concat(Math.random().toString(36).substring(7)),!f)return this.element={},this.iframe={},void(this.boundMessageHandler=null);this.element=document.createElement("div"),this.iframe=document.createElement("iframe"),this.boundMessageHandler=this.handleMessage.bind(this),this.setupElement(),this.setupIframe(),window.addEventListener("message",this.boundMessageHandler)},t=[{key:"setupElement",value:function(){f&&(this.element.className="hyperswitch-element ".concat(this.options.className||"").trim(),this.element.dataset.hyperswitchElement=this.getElementType(),Object.assign(this.element.style,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({width:this.options.width||"100%",height:this.options.height||"500px",overflow:"hidden"},this.options.style||{})))}},{key:"setupIframe",value:function(){f&&(this.iframe.src=this.getIframeSrc(),this.iframe.style.border="none",this.iframe.style.width="100%",this.iframe.style.height="100%",this.iframe.title="Hyperswitch ".concat(this.getElementType()),this.iframe.setAttribute("allow","clipboard-read; clipboard-write; clipboard-sanitized-write"),this.iframe.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-forms allow-modals allow-presentation allow-downloads"),this.element.appendChild(this.iframe))}},{key:"handleMessage",value:function(e){var t;if(f&&(this.options.onMessage&&this.options.onMessage(e.data),"EMBEDDED_COMPONENT_RESIZE"===(null===(t=e.data)||void 0===t?void 0:t.type))){var n=e.data.height;(e.data.component||"")===this.getElementType()&&"number"==typeof n&&n>0&&(this.element.style.height="".concat(n,"px"),this.options.onResize&&this.options.onResize({width:this.element.clientWidth,height:n}))}}},{key:"mount",value:function(e){if(!f)throw new Error("Hyperswitch elements can only be mounted in a browser environment.");var t="string"==typeof e?document.querySelector(e):e;if(!t)throw new Error("Invalid mount point: ".concat(e));return t.appendChild(this.element),this}},{key:"destroy",value:function(){f&&(this.boundMessageHandler&&window.removeEventListener("message",this.boundMessageHandler),this.element.parentNode&&this.element.parentNode.removeChild(this.element))}},{key:"getIframe",value:function(){return this.iframe}}],t&&u(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function w(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var u=r&&r.prototype instanceof c?r:c,s=Object.create(u.prototype);return g(s,"_invoke",function(n,r,o){var i,c,u,s=0,f=o||[],l=!1,p={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return i=t,c=0,u=e,p.n=n,a}};function h(n,r){for(c=n,u=r,t=0;!l&&s&&!o&&t<f.length;t++){var o,i=f[t],h=p.p,y=i[2];n>3?(o=y===r)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=n<2&&h<i[1])?(c=0,p.v=r,p.n=i[1]):h<y&&(o=n<3||i[0]>r||r>y)&&(i[4]=n,i[5]=r,p.n=y,c=0))}if(o||n>1)return a;throw l=!0,r}return function(o,f,y){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&h(f,y),c=f,u=y;(t=c<2?e:u)||!l;){i||(c?c<3?(c>1&&(p.n=-1),h(c,u)):p.n=u:p.v=u);try{if(s=2,i){if(c||(o="next"),t=i[o]){if(!(t=t.call(i,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,c<2&&(c=0)}else 1===c&&(t=i.return)&&t.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=e}else if((t=(l=p.n<0)?u:n.call(r,p))!==a)break}catch(t){i=e,c=1,u=t}finally{s=1}}return{value:t,done:l}}}(n,o,i),!0),s}var a={};function c(){}function u(){}function s(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(g(t={},r,function(){return this}),t),l=s.prototype=c.prototype=Object.create(f);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,g(e,o,"GeneratorFunction")),e.prototype=Object.create(l),e}return u.prototype=s,g(l,"constructor",s),g(s,"constructor",u),u.displayName="GeneratorFunction",g(s,o,"GeneratorFunction"),g(l),g(l,o,"Generator"),g(l,r,function(){return this}),g(l,"toString",function(){return"[object Generator]"}),(w=function(){return{w:i,m:p}})()}function g(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}g=function(e,t,n,r){function i(t,n){g(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},g(e,t,n,r)}function E(e,t,n,r,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function k(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){E(i,r,o,a,c,"next",e)}function c(e){E(i,r,o,a,c,"throw",e)}a(void 0)})}}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,j(r.key),r)}}function T(e,t,n){return(t=j(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e){var t=function(e){if("object"!=b(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==b(t)?t:t+""}var P="undefined"!=typeof window,S=function(){return e=function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),T(this,"token",null),T(this,"activeElements",new Map),T(this,"isRefetchingToken",!1),T(this,"tokenError",null),!t||"function"!=typeof t.fetchToken)throw new Error("loadHyperswitch requires a fetchToken callback function");this.fetchToken=t.fetchToken,this.initPromise=this.fetchInitialToken(),P&&this.listenForMessages()},t=[{key:"fetchInitialToken",value:function(){var e=this;return function(){try{return e.fetchToken()}catch(e){return Promise.reject(e)}}().then(function(t){t?e.token=t:e.tokenError="Failed to fetch token: Token returned empty or undefined"}).catch(function(t){e.tokenError="Failed to fetch token: ".concat(t instanceof Error?t.message:String(t))})}},{key:"listenForMessages",value:function(){var e=this;P&&window.addEventListener("message",function(){var t=k(w().m(function t(n){var r,o,i;return w().w(function(t){for(;;)switch(t.n){case 0:if("TOKEN_EXPIRED"!==(null===(r=n.data)||void 0===r?void 0:r.type)||!0!==(null===(o=n.data)||void 0===o?void 0:o.value)){t.n=2;break}return t.n=1,e.refetchAndBroadcastToken();case 1:t.n=3;break;case 2:"EMBEDDED_IFRAME_READY"===(null===(i=n.data)||void 0===i?void 0:i.type)&&e.activeElements.forEach(function(t){var r=t.getIframe();(null==r?void 0:r.contentWindow)===n.source&&e.onElementIframeLoaded(t)});case 3:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"refetchAndBroadcastToken",value:(n=k(w().m(function e(){var t,n,r=this;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.isRefetchingToken){e.n=1;break}return e.a(2);case 1:return this.isRefetchingToken=!0,e.p=2,e.n=3,this.fetchToken();case 3:(t=e.v)?(this.token=t,this.tokenError=null,this.activeElements.forEach(function(e,t){var n=e.getIframe();null!=n&&n.contentWindow&&n.contentWindow.postMessage({type:"AUTH_TOKEN",token:r.token},"*")})):(this.tokenError="Failed to refetch token: Token returned empty or undefined",this.sendErrorToActiveElements(this.tokenError)),e.n=5;break;case 4:e.p=4,n=e.v,this.tokenError="Failed to refetch token: ".concat(n instanceof Error?n.message:String(n)),this.sendErrorToActiveElements(this.tokenError);case 5:return e.p=5,this.isRefetchingToken=!1,e.f(5);case 6:return e.a(2)}},e,this,[[2,4,5,6]])})),function(){return n.apply(this,arguments)})},{key:"sendErrorToActiveElements",value:function(e){this.activeElements.forEach(function(t){var n=t.getIframe();null!=n&&n.contentWindow&&n.contentWindow.postMessage({type:"AUTH_ERROR",error:e},"*")})}},{key:"create",value:function(e,t){var n;if("connectors"!==e)throw new Error("Unknown element type: ".concat(e));return n=new v(this,t),this.activeElements.set(n._internalId,n),n}},{key:"onElementIframeLoaded",value:function(e){var t=this;this.initPromise.then(function(){var n=e.getIframe();null!=n&&n.contentWindow&&setTimeout(function(){try{var e=n.contentWindow;if(!e)return;t.tokenError?e.postMessage({type:"AUTH_ERROR",error:t.tokenError},"*"):t.token?e.postMessage({type:"AUTH_TOKEN",token:t.token},"*"):e.postMessage({type:"AUTH_ERROR",error:"No token available"},"*")}catch(e){}},100)}).catch(function(t){var n=e.getIframe(),r=null==n?void 0:n.contentWindow;r&&setTimeout(function(){try{r.postMessage({type:"AUTH_ERROR",error:"Token initialization failed: ".concat(t instanceof Error?t.message:String(t))},"*")}catch(e){}},100)})}}],t&&O(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function _(e){return new S(e)}var R=r(155),M=r.n(R),I=(0,R.createContext)(null);function H(e){var t=e.hyperswitchInstance,n=e.children;return M().createElement(I.Provider,{value:t},n)}var x=function(e){var t=function(){var e=(0,R.useContext)(I);if(!e)throw new Error("useHyperswitchInstance must be used within a HyperswitchProvider");return e}(),n=(0,R.useRef)(null);return(0,R.useEffect)(function(){if(n.current){var r=t.create("connectors",e);return r.mount(n.current),function(){r.destroy()}}},[t,e]),R.createElement("div",{ref:n})};x.displayName="ConnectorConfiguration";var A="1.0.0";return o})());